{% extends "base.html" %}

{% block content %}
<h2 class="text-2xl font-bold mb-4">{{ plot.name }}</h2>
<p class="font-semibold"><strong>Location:</strong></p>
<div id="map" class="mb-4" style="height: 400px;"></div>

<script>
    var map = L.map('map').setView([0, 0], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    var geojsonFeature = {{ plot.location.geojson|safe|escapejs }};
    L.geoJSON(geojsonFeature).addTo(map);
    map.fitBounds(L.geoJSON(geojsonFeature).getBounds());
</script>

<h3 class="text-xl font-semibold mt-6 mb-2">Seasons</h3>
<ul class="list-disc pl-5">
    {% for season in seasons %}
        <li class="mb-2">
            <span class="font-medium">{{ season.crop }}</span> <span class="text-gray-600">({{ season.start_date }} - {{ season.end_date }})</span>
            <ul class="list-disc pl-5 mt-1">
                {% for event in season.events.all %}
                    <li class="text-gray-700">{{ event.event_date }} {{ event.event_type }}</li>
                {% empty %}
                    <li class="text-gray-500">No events for this season.</li>
                {% endfor %}
                <!-- Link to add event to this season -->
                <li><a href="{% url 'event_create' season.pk %}" class="text-blue-500 hover:underline">Add Event to Season</a></li>
            </ul>
            <!-- Timeseries Data Section -->
            <div class="timeseries-data mt-4">
                <h4 class="text-lg font-semibold">Timeseries Data</h4>
                <div>
                    <strong>Cloud Timeline:</strong>
                    <pre>{{ season.cloud_timeline|safe }}</pre>
                </div>
                <div>
                    <strong>Precipitation:</strong>
                    <pre>{{ season.precipitation|safe }}</pre>
                </div>
                <div>
                    <strong>Methane:</strong>
                    <pre>{{ season.methane|safe }}</pre>
                </div>
            </div>
        </li>
    {% empty %}
        <li class="text-gray-500">No seasons available.</li>
    {% endfor %}
</ul>
<a href="{% url 'season_create' plot.pk %}" class="mt-4 inline-block bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">Add New Season</a>
{% endblock %}
